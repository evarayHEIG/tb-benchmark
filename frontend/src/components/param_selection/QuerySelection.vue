<!--
  @fileoverview QuerySelection component that allows users to select a query type and number of executions.
  @component QuerySelection
  @author Eva Ray
  @description This component provides a dropdown for selecting a query type from a list fetched from the server,
  and an input field for specifying the number of executions. It emits the selected query and number of executions to
  the parent component. The style has been generated by an LLM.
-->

<script setup>
import { ref, onMounted } from 'vue'

const queries = ref([])
const selectedQueryValue = ref('')
const numberOfExecutions = ref(1)

// Fetch available queries from the server
onMounted(async () => {
  try {
    const response = await fetch('http://localhost:7070/meta/queries')
    if (!response.ok) throw new Error('Network')
    queries.value = await response.json()
    queries.value.sort((a, b) => a.label.localeCompare(b.label))
  } catch (error) {
    console.error('Error loading queries:', error)
  }
})

// Expose data to parent component
defineExpose({
  getSelections: () => {
    const selected = queries.value.find(q => q.value === selectedQueryValue.value)
    return {
      selectedQuery: selected ? selected.value : null,
      numberOfExecutions: numberOfExecutions.value
    }
  }
})
</script>

<template>
  <div class="container">
    <h2>Query</h2>
    <div class="form">
      <div class="form-row">
        <label for="query-select">Type of query :</label>
        <select id="query-select" v-model="selectedQueryValue" class="dropdown">
          <option disabled value="">Select query</option>
          <option v-for="query in queries" :key="query.value" :value="query.value">
            {{ query.label }}
          </option>
        </select>
      </div>
      <div class="form-row">
        <label for="executions-input">Number of executions :</label>
        <input id="executions-input" v-model="numberOfExecutions" type="number" class="input" min="1" step="1" />
      </div>
    </div>
  </div>
</template>

