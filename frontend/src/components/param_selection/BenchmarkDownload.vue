<!--
  @fileoverview BenchmarkDownload component that allows users to download benchmark reports.
  @component BenchmarkDownload
  @author Eva Ray
  @description This component provides a button to download the benchmark report as an HTML file. It checks if there is
  benchmark data available before allowing the download.
  The style has been generated by an LLM.
-->

<template>
  <div class="benchmark-download">
    <button 
      @click="downloadReport"
      :disabled="loading || !hasBenchmarkData"
      class="btn btn-large">
      {{ loading ? 'Generating...' : 'Download Report' }}
    </button>
    <p v-if="!hasBenchmarkData" class="text-error">
      Please run a benchmark first to generate a report
    </p>
  </div>
</template>

<script>
export default {
  name: 'BenchmarkDownload',
  
  props: {
    benchmarkData: {
      type: Object,
      default: () => ({})
    }
  },
  
  data() {
    return {
      loading: false
    };
  },
  
  computed: {
    hasBenchmarkData() {
      return this.benchmarkData && Object.keys(this.benchmarkData).length > 0;
    }
  },
  
  methods: {
    async downloadReport() {
      if (!this.hasBenchmarkData) {
        alert('Aucune donnée de benchmark disponible. Veuillez d\'abord exécuter un benchmark.');
        return;
      }

      this.loading = true;
      
      try {
        const response = await fetch('http://localhost:7070/generate-report', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(this.benchmarkData)
        });
        
        if (!response.ok) {
          throw new Error(`Error: ${response.status} - ${response.statusText}`);
        }
        
        // Get the response as a blob
        const blob = await response.blob();
        
        // Create a URL for the blob
        const url = URL.createObjectURL(blob);
        
        // Create a link element to trigger the download
        const link = document.createElement('a');
        link.href = url;
        link.download = `benchmark-report-${new Date().toISOString().slice(0, 10)}.html`;
        document.body.appendChild(link);
        link.click();
        
        // Clean up the link element and revoke the object URL
        setTimeout(() => {
          document.body.removeChild(link);
          URL.revokeObjectURL(url);
        }, 100);
        
      } catch (error) {
        console.error('Error downloading report:', error);
        alert(`Error downloading report: ${error.message}`);
      } finally {
        this.loading = false;
      }
    }
  }
}
</script>

<style>
.benchmark-download {
  margin: 20px 0;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
}
</style>