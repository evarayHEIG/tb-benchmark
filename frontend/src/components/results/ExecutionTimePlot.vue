<!--
  @fileoverview ExecutionTimePlot component that visualizes execution times of database queries using a grouped bar chart.
  @component ExecutionTimePlot
  @author Eva Ray
  @description This component renders a grouped bar chart to visualize the execution times of different database queries.
  The style has been generated by an LLM.
 -->

<script setup lang="ts">
import { VisXYContainer, VisAxis, VisGroupedBar } from '@unovis/vue'
import { computed } from 'vue'

type DataRecord = { x: string | number, y: number }

const props = defineProps<{ data: DataRecord[] }>()

/**
 * Computed property to transform the input data for the chart.
 * If no data is provided, it returns a placeholder to avoid rendering issues.
 */
const data = computed(() => {
    if (props.data.length === 0) {
        return [{ x: 0, y: 0 }] // Placeholder for no data
    }
    // Si x est une string (nom de DB), on utilise l'index, sinon on garde la valeur
    return props.data.map((d, i) => ({
        x: typeof d.x === 'string' ? i : d.x,
        y: d.y,
        originalX: d.x // Garder la valeur originale pour la lÃ©gende
    }))
})

const x = (d: DataRecord) => d.x
const y = [
    (d: DataRecord) => d.y
]
const color = (d: DataRecord) => ['#04c0c7', '#5144d3', '#da348f'][d.x]
</script>

<template>
    <div class="card card-large">
        <div class="chart-content">
            <VisXYContainer :data="data" height="200">
                <VisGroupedBar orientation="horizontal" :x="x" :y="y" :color="color" />
                <VisAxis type="y" :label="'Database Type'" :tickFormat="() => ''"/>
                <VisAxis type="x" :label="'Execution Time (ms)'" :tickFormat="(d) => `${d}ms`" />
            </VisXYContainer>
        </div>
        <div v-if="props.data.length > 0" class="legend">
            <div class="legend-item" v-for="(d, index) in props.data" :key="d.x">
                <div class="legend-color" :style="{ backgroundColor: ['#04c0c7', '#5144d3', '#da348f'][index] }"></div>
                <span class="legend-text">{{ d.x }}</span>
            </div>
        </div>
    </div>
</template>

