<!--
  @fileoverview WorkloadPlan component that displays execution plans grouped by query type.
  @component WorkloadPlan
  @author Eva Ray
  @description This component displays execution plans for different queries grouped by their type. It uses the
  TextCard component to render each plan and organizes them in a grid layout.
  The style has been generated by an LLM.
 -->

<script setup>
import { computed } from 'vue'
import TextCard from './TextCard.vue'

const props = defineProps({
    executionPlans: {
        type: Array,
        required: true,
        default: () => []
    }
})

/**
 * Groups execution plans by query type.
 * @returns {Object} An object where keys are query names and values are arrays of execution plans.
 */
const groupedPlans = computed(() => {
    const grouped = {}

    props.executionPlans.forEach(plan => {
        if (!grouped[plan.queryName]) {
            grouped[plan.queryName] = []
        }
        grouped[plan.queryName].push({
            dbName: plan.dbName,
            explainPlan: plan.explainPlan,
            query: plan.query
        })
    })

    return grouped
})
</script>

<template>
    <div v-if="executionPlans && executionPlans.length > 0" class="content-container">
        <h2 class="text-center">Execution Plans by Query Type</h2>
        <div v-for="(plans, queryName) in groupedPlans" :key="queryName" class="query-section">
            <h4 class="text-center">{{ queryName }} Query</h4>
            <div class="execution-plans-grid">
                <div v-for="plan in plans" :key="`${queryName}-${plan.dbName}`" class="card">
                  <h3>{{ plan.dbName }}</h3>
                  <TextCard
                      :title="'Query'"
                      :content="plan.query"
                  />
                  <TextCard
                        :title="'Execution Plan'"
                        :content="plan.explainPlan"
                    />

                </div>
            </div>
        </div>
    </div>
    <div v-else class="no-data">
        <p>No execution plans available</p>
        <p>{{ executionPlans?.length || 0 }} plans received</p>
    </div>
</template>


<style>
.query-section {
    margin-bottom: 40px;
}

.query-section:last-child {
    margin-bottom: 0;
}

.execution-plans-grid {
    display: flex;
    flex-direction: column;
    align-items: center;
    flex-wrap: wrap;
    gap: 24px;
}

.execution-plan-card {
    width: 95%;
}

h3 {
  color: #23272f;
  font-size: 1.5rem;
  font-weight: 600;
  margin: 40px 0 24px;
  text-align: center;
  letter-spacing: 0.01em;
}
</style>